<!--
Masons place and organize Tiles
Controls Drag and Drop
Append Tiles to Masons to create Walls
-->


<script>
  var container = document.querySelector('#<%=divId%>');
  var <%=divId%>msnry = new Masonry( container, {
   columnWidth: 360,
  });
  <%=divId%>msnry.layout();

  //drag n drop functions
  function allowDrop(ev){
    ev.preventDefault();
  }

  function drag(ev){
    ev.dataTransfer.setData("Text",ev.target.id);
  }


  function drop(ev){
    ev.preventDefault();
    var data=ev.dataTransfer.getData("Text");
    console.log("sending "+data+" to "+ev.target.parentElement.id);


    if(ev.target.parentElement.id === 'trash-drop'){
      document.getElementById(data).remove();
      <%=divId%>msnry.layout();
      console.log(<%=divId%>)
    }
  }



</script>


<!-- on startup, keep loading until screen is full -->
<% while (!view.loading && $(window).scrollTop() >= ( $(document).height() - $(window).height()*1.3)){ %>
  <% view.loading = true;%>
  <% view.loadMore(); %>
<% } %>

<!-- infinite scroll -->
<% $(window).scroll(function() { %>
  <% if (!view.loading && $(window).scrollTop() >= ( $(document).height() - $(window).height()*1.3)){ %>
    <% view.loading = true;%>
    <% view.loadMore(); %>
  <% } %>
<% }) %>